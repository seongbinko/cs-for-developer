# TCP/IP/UDP HTTP 통신을 기준

### TCP UDP IP 모두 통신 규약이다.
### 네트워크 제어용 소프트웨어, 하드웨어는 통신 규약에 의거하여 패킷을 생성, 전송한다.

## TCP(Transmission Control Protocol)
### 1. TCP헤더 생성
TCP헤더 주요 항목
송신처 포트번호* : 이 패킷을 송신한 측의 프로그램의 포트번호
수신처 포트번호 : 이 패킷을 받는 상대의 프로그램의 포트 번호(브라우저에서 HTTP요청시 첫 수신처는 웹서버포트로 할당)
시퀀스 번호 : 이 패킷의 맨 앞 위치의 데이터가 송신 데이터의 몇 번째 바이트에 해당하는지를 나타냄
ACK 번호 : 데이터가 몇 바이트 까지 수신측에 도달했는지를 수신측에서 송신측에 전달
데이터 오프셋 : 데이터가 어디부분부터 시작하는지를 나타냄, 헤더의 길이를 나타낸다고 보면 됨
윈도우* : 수신측에서 송신측에 윈도우 사이즈(수신가능한 메모리 양)를 통지하기 위해 사용
체크섬 : 오류 판별용 

* 윈도우제어방식: TCP통신에서 한 개의 패킷을 보낸 뒤 수신확인을 위해 ACK번호를 계속해서 기다리는 것은 자원 낭비.
따라서 한 개의 패킷을 보낸 후 ACK번호를 기다리지 않고 차례대로 연속해서 복수의 패킷을 보내는 방법을 사용하는데,
이 때 수신측의 수신능력을 초과하여(메모리 등) 데이터를 전송하는 일이 없도록 수신측에서는 자신이 수신가능한 크기를 송신측에 전송하는데 이를 윈도우 사이즈라고 한다.


* 포트번호, 디스크립터, 소켓
소켓이란 OS 프로토콜 스택에 있는 통신 제어용 정보
통신상대의 IP주소, 포트번호, 통신동작의 진행상태(응답이 돌아왔는지 여부, 송신 후 경과시간 등)
포트번호란
상대측의 소켓을 식별하기 위한 정보
디스크립터란
로컬측의 소켓을 식별하기 위한 정보


### 2. TCP헤더에 데이터를 부가하여 패킷 생성
실제 HTTP 데이터를 여러 조각으로 쪼개서
헤더에 붙인 것을 패킷으로 전송하게 된다.
이때 헤더에는 이 데이터가 원래 데이터에서 몇 번째 바이트에 해당하는 것인지를 나타내기 위해 시퀀스번호라는 헤더항목이 기록된다.

### 3. TCP의 수신확인 응답
수신측에서는 송신측에서 날아온 SEQ 번호를 보고 판단한다.
예를들어 1460번째 바이트까지 수신완료한 상태에서 시퀀스번호가 1461인 패킷이 도착하면 누락이 없다는 것을 알 수 있고, 시퀀스 번호가 1461인 패킷이 도착하지 않았는데
시퀀스번호가 2921인 패킷이 도착하면 누락된 것을 알 수 있다.
결과적으로 누락 없는 것을 확인 하면
수신측은 수신한 데이터를 합쳐서 몇 번째 바이트까지 수신한 것인지 계산하여 TCP헤더의 ACK번호에 기록하여 송신측에 전달한다.


이렇게 TCP의 역할이 끝나고 나면
TCP는 만든 패킷을 IP담당 부분에 건네주게 된다.




## IP(Internet Protocol) Message Protocol)
### 1. IP 헤더 생성, MAC 헤더 생성(이더넷에서 목적지를 찾아가기 위한 정보)

IP헤더 주요항목
송신처 IP 주소 : 컴퓨터에 할당된 IP 주소
정확히는 컴퓨터에 부착된 네트워크 제어용 하드웨어에 할당된 IP 주소인데,
이 하드웨어가 여러개가 부착된 하드웨어는 복수의 IP를 가진다.
따라서 이 중 어느 IP를 사용할지는 IP경로표를 참고하여 결정한다.
*IP경로표란, 수신할 IP를 가진 네트워크 장비에 패킷을 보내려면 어느 네트워크 장비를 택해야 하는지를 정리해 놓은 표.
수신처 IP 주소 : 어플리케이션에서 통지된 송신처 IP 주소 사용
프로토콜번호 : TCP(06, 16진수), UDP(11, 16진수), ICMP(01, 16진수)*
생존기간 : 네트워크에 루프가 만들어 질 때 패킷이 영구적으로 순환되지 않도록 생존기간을 지정한 것. 라우터를 경유할 때마다 값이 1씩 감소하여 0이되면 폐기.\

* ICMP(Internet Control)
패킷을 운반할 때 발생하는 오류를 통지하거나 제어용 메시지를 통지할 때 사용

MAC헤더 주요항목
수신처 MAC주소 : ARP(Address Resolution Protocol)를 활용해 조사
ARP란
이더넷에서 브로드캐스트 통신(연결된 전원에게 패킷을 전달)을 활용해 특정 IP주소를 가진 네트워크 장비를 찾는다.(그 장비에서 MAC 주소에 대한 응답이 돌아옴)

송신처 MAC 주소 : 네트워크 제어용 하드웨의 ROM에 기록된 것을 참조
이더타입(Ether type) : IP, ARP 등등을 기록

이 후로는 IP부분을 거친 패킷이 네트워크 제어용 하드웨어에 넘겨지고 케이블을 통한 데이터 송출이 시작됨.


## UDP(User Datagram Protocol)

TCP가 복잡한 이유:
데이터를 여러 패킷으로 분할하여 송/수신을 할 때에
만일 데이터 송/수신이 누락되었고 이를 효율적으로 다시 보내려면
누락된 패킷‘만’ 다시 보내야 한다.
TCP는 이 과정을 SEQ, ACK번호를 통해 제어하는데 이 일을 하기 때문에 TCP는 상대적을 복잡한 프로토콜이라고 할 수 있다.

이때 만약 원본데이터가 여러 패킷으로 쪼갤 필요가 없을 정도로 작아서
한 개의 패킷으로만 송/수신이 완료될 경우라면
굳이 TCP를 사용할 필요가 없다.

TCP와의 차이 : 오류검출 안함, 접속 및 연결 끊기 동작 시에 제어용 패킷전달 필요 없다.
(SEQ번호 초기값을 알 필요가 없기 때문)

UDP 활용 예: DNS 서버 조회, 음성 및 동영상 데이터



## 참고
Tsutomu Tone, 성공과 실패를 결정하는 1%의 네트워크 원리, (주)도서출판 성안당
